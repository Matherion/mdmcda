---
title: "Minimal Dynamic Multi-Criteria Decision Aid example"
author: "Gjalt-Jorn Peters"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Minimal Dynamic Multi-Criteria Decision Aid example}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, message=FALSE, echo=FALSE, results='asis'}

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  dev="png", 
	dev.args=list(type="cairo"),
	dpi=100
);

### Show code and table of contents label in HTML only
if ("html_document" %in% knitr::opts_knit$get("rmarkdown.pandoc.to")) {
  knitr::opts_chunk$set(echo=TRUE);
  cat("\n\n# Contents\n\n");
} else {
  knitr::opts_chunk$set(echo=FALSE);
}

tryCatch({
  suppressMessages(remotes::install_gitlab("r-packages/yum",
                                           upgrade="never", quietly=TRUE));
  suppressMessages(remotes::install_gitlab("r-packages/justifier",
                                           upgrade="never", quietly=TRUE));
  suppressMessages(remotes::install_gitlab("r-packages/dmcda",
                                           upgrade="never", quietly=TRUE));
}, error=invisible);

### First get the directory where 'dmcda' is installed
currentDir <- system.file(package="dmcda");

### Specify the path of the example DMCDA files
currentDir <- file.path(currentDir, "extdata");

#currentDir <- "B:/Data/society & valorisation/think-tanks/mdma"

```

# Defined decisions

```{r load-decisions}

decisions_and_options <-
  dmcda::load_decisions(currentDir);

```

```{r decisions-summary, results="asis"}

dmcda::summary_decisions(decisions_and_options);

```

```{r decisions-details, results="asis"}

dmcda::details_decisions(decisions_and_options);

```

# Defined criteria {.tabset}

Criteria are the criteria that are important for making the decisions. These will often be outcomes resulting from the choices made in each scenario.

```{r load-outcomes}

criteria <-
  dmcda::load_criteria(currentDir);

```

`r dmcda::insert_if_knitting_to_html("Click the 'details' tab to see more detailed information."); `

```{r criteria-summary, fig.width=16, fig.height=12}

dmcda::summary_criteria(criteria);

```

```{r criteria-details}

dmcda::details_criteria(criteria);

```

# Estimates {.tabset}

```{r load-estimates, fig.width=10}

estimates <-
  dmcda::load_estimates(currentDir,
                        decisions_and_options = decisions_and_options,
                        criteria = criteria);

```

`r dmcda::insert_if_knitting_to_html("Click the 'details' tab to see more detailed information."); `

```{r estimates-summary, fig.width=10}

dmcda::summary_estimates(estimates);

```

```{r estimates-details, fig.width=10}

dmcda::details_estimates(estimates);

```

# Definities van scenario's {.tabset}

```{r read-scenarios}

scenarios_and_options <-
  dmcda::load_scenarios(currentDir,
                        decisions_and_options = decisions_and_options);

```

```{r scenarios-summary, results="asis"}

dmcda::summary_scenarios(scenarios_and_options);

```

## Details

```{r scenarios-details, results="asis"}

dmcda::details_scenarios(scenarios_and_options);

```

# Weights of the criteria {.tabset}

```{r read-weights}

weights <-
  dmcda::load_weights(currentDir,
                      criteria=criteria);

```

```{r show-weights, results="asis"}

dmcda::details_weights(weights);

```

```{r show-multiplied-weights, results="asis"}

dmcda::details_multiplied_weights(weights);

```

# General overview {.tabset}

```{r total-overview-autofill}

estimates <-
  dmcda::autofill_estimates(estimates=estimates,
                            criteria=criteria,
                            decisions_and_options=decisions_and_options);

```

## Summary

`r dmcda::summary_general(criteria, decisions_and_options, estimates);`

## Details

```{r total-overview-details, results="asis"}

dmcda::details_autofilled_estimates(estimates);

```

## Counterfactuals

Bij assertions is het goed om counterfactuals te definieren. Dat zijn dan verwijzingen naar andere assertions die ook sources hebben. Scoren voor # counterfactuals en kwaliteit van evidentie per assertion?

## Logs

```{r total-overview-autofill-logs, results='asis'}
cat(paste0(estimates$autofillLogs,
           collapse="\n"));
```

# Scores for each scenario and weight profile

```{r scores-summary, results="asis", eval=FALSE}

estimates <-
  weight_estimates(estimates=estimates,
                   weights=weights);

scores <-
  scenario_scores();

```

