---
title: "Minimal Dynamic Multi-Criteria Decision Aid example"
author: "Gjalt-Jorn Peters"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Minimal Dynamic Multi-Criteria Decision Aid example}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, message=FALSE, echo=FALSE, results='asis'}

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  dev="png", 
	dev.args=list(type="cairo"),
	dpi=100
);

### Show code and table of contents label in HTML only
if ("pdf_document" %in% knitr::opts_knit$get("rmarkdown.pandoc.to")) {
  knitr::opts_chunk$set(echo=FALSE);
} else if ("html_document" %in% knitr::opts_knit$get("rmarkdown.pandoc.to")) {
  knitr::opts_chunk$set(echo=TRUE);
  cat("\n\n# Contents\n\n");
} else {
  knitr::opts_chunk$set(echo=TRUE);
}

# tryCatch({
#   invisible(suppressMessages(remotes::install_gitlab("r-packages/yum",
#                                            upgrade="never", quietly=TRUE)));
#   invisible(suppressMessages(remotes::install_gitlab("r-packages/justifier",
#                                            upgrade="never", quietly=TRUE)));
#   invisible(suppressMessages(remotes::install_gitlab("r-packages/dmcda",
#                                            upgrade="never", quietly=TRUE)));
# }, error=invisible);

### First get the directory where 'dmcda' is installed
currentDir <- system.file(package="dmcda");

### Specify the path of the example DMCDA files
currentDir <- file.path(currentDir, "extdata");

#currentDir <- "B:/Data/society & valorisation/think-tanks/mdma"

```

<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->

# Defined criteria {.tabset}

Criteria are the criteria that are important for making the decisions. These will often be outcomes resulting from the choices made in each scenario. The criteria are what drive the decisions. They are normally not directly under control, but are assumed to result from the decisions.

```{r load-outcomes}

criteria <-
  dmcda::load_criteria(currentDir);

```

`r dmcda::insert_if_knitting_to_html("Click the 'details' tab to see more detailed information."); `

```{r criteria-summary, fig.width=16, fig.height=12}

dmcda::summary_criteria(criteria);

```

```{r criteria-details}

dmcda::details_criteria(criteria);

```

<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->

# Defined decisions

The decisions are the choices that have to be made. Each decision consists of two or more mutually exclusive and exhaustive alternatives.

```{r load-decisions}

decisions_and_alternatives <-
  dmcda::load_decisions(currentDir);

```

```{r decisions-summary, results="asis"}

dmcda::summary_decisions(decisions_and_alternatives);

```

```{r decisions-details, results="asis"}

dmcda::details_decisions(decisions_and_alternatives);

```

<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->

# Estimates {.tabset}

Estimates are the estimates of the effects that every alternative will have on each of the specified criteria. Ideally, every estimate has a justification, which is based on assertions (statements of facts or assumptions) that can be traced back to sources (e.g. scientific articles, policy documents, expert consensus, etc). For example, 

```{r load-estimates, fig.width=10}

estimates <-
  dmcda::load_estimates(currentDir,
                        decisions_and_alternatives = decisions_and_alternatives,
                        criteria = criteria);

```

`r dmcda::insert_if_knitting_to_html("Click the 'details' tab to see more detailed information."); `

```{r estimates-summary, fig.width=10}

dmcda::summary_estimates(estimates);

```

```{r estimates-details, fig.width=10}

dmcda::details_estimates(estimates);

```

<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->

# Scenarios {.tabset}

Scenarios are sets of coherent alternative selections for every decision.

```{r read-scenarios}

scenarios_and_alternatives <-
  dmcda::load_scenarios(currentDir,
                        decisions_and_alternatives = decisions_and_alternatives);

```

```{r scenarios-summary, results="asis"}

dmcda::summary_scenarios(scenarios_and_alternatives);

```

```{r scenarios-details, results="asis"}

dmcda::details_scenarios(scenarios_and_alternatives);

```

<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->

# Weights of the criteria {.tabset}

```{r read-weights}

weights <-
  dmcda::load_weights(currentDir,
                      criteria=criteria);

```

```{r show-weights, results="asis"}

dmcda::details_weights(weights);

```

```{r show-multiplied-weights, results="asis"}

dmcda::details_multiplied_weights(weights);

```

<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->

# General overview {.tabset}

```{r total-overview-autofill}

estimates <-
  dmcda::autofill_estimates(estimates=estimates,
                            criteria=criteria,
                            decisions_and_alternatives=decisions_and_alternatives);

```

## Summary

`r dmcda::summary_general(criteria, decisions_and_alternatives, estimates);`

## Details

```{r total-overview-details, results="asis"}

dmcda::details_autofilled_estimates(estimates);

```

<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->

# Scores for each scenario and weight profile

```{r scores-compute, results="asis", eval=TRUE}

estimates <-
  dmcda::weigh_estimates(estimates=estimates,
                         weights=weights);

scenario_scores <-
  dmcda::scenario_scores(criteria = criteria,
                         decisions_and_alternatives = decisions_and_alternatives,
                         estimates = estimates,
                         scenarios_and_alternatives = scenarios_and_alternatives,
                         weights = weights);

```

```{r scores-summary, results="asis", eval=TRUE}

dmcda::summary_scores(scenario_scores);

```

```{r scores-details, results="asis", eval=TRUE}

dmcda::details_scores(scenario_scores);

```

<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->

# Appendices

## Assertions

This is an overview of all assertions (all 'facts'. 'claims', 'assumptions', or 'propositions' that are based on some form of evidence) that this DMCDA is based on. Assertions can have a certain evidence quality, which can be specified and scored.

```{r assertions-details, results="asis", eval=TRUE}

dmcda::details_assertions(estimates);

```

## Counterfactuals

When formulating assertions, it is also good practice to formulate counterfactuals. This are references to other assertions that also have sources. This enables for example scoring for the number of counterfactuals.

## Sources / literature

This is an overview of all sources that the assertions refer to.

```{r sources-details, results="asis", eval=TRUE}

dmcda::details_sources(estimates);

```

## Logs

These are more detailed logs.

```{r total-overview-autofill-logs, results='asis', eval=FALSE}
cat(paste0(estimates$autofillLogs,
           collapse="\n"));
```
